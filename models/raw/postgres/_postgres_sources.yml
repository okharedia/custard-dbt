version: 2

sources:
  - name: public
    database: postgres
    schema: public
    tables:
      - name: households
        description: "The households table"
        columns:
          - name: id
            description: The primary key for this table
            data_tests:
              - unique
              - not_null
          - name: name
            description: The name of the household
            data_tests:
              - not_null
          - name: created_at
            description: The date and time the household was created
            data_tests:
              - not_null
          - name: updated_at
            description: The date and time the household was updated
            data_tests:
              - not_null

      - name: parents
        description: "The parents table"
        columns:
          - name: id
            description: "The primary key for this table"   
            data_tests:
              - unique
              - not_null
          - name: name
            description: "The name of the parent"
            data_tests:
              - not_null
          - name: household_id
            description: "The id of the household the parent belongs to"
            data_tests:
              - not_null
              - relationships:
                  arguments:
                    to: source('public', 'households')
                    field: id
          - name: created_at
            description: "The date and time the parent was created"
          - name: updated_at
            description: "The date and time the parent was updated"

      - name: schedules
        description: "The schedules table"
        columns:
          - name: parent_id
            description: "The id of the parent the schedule belongs to"
            data_tests:
              - not_null
              - relationships:
                  arguments:
                    to: source('public', 'parents')
                    field: id
          - name: calendar
            description: "The ical calendar format of the schedule"
            data_tests:
              - not_null
          - name: created_at
            description: "The date and time the schedule was created"
          - name: updated_at
            description: "The date and time the schedule was updated"

      - name: base_agreements
        description: "The base agreements table"
        columns:
          - name: id
            description: "The primary key for this table"
          - name: during
            description: "The start and end time of the base agreement"
            data_tests:
              - not_null
          - name: parent_id
            description: "The id of the parent the base agreement belongs to"
            data_tests:
              - not_null
              - relationships:
                  arguments:
                    to: source('public', 'parents')
                    field: id

      - name: additional_agreements
        description: "The additional agreements table"
        columns:
          - name: id
            description: "The primary key for this table"
          - name: from_parent_id
            description: "The id of the parent giving the additional agreement"
            data_tests:
              - not_null
              - relationships:
                  arguments:
                    to: source('public', 'parents')
                    field: id
          - name: to_parent_id
            description: "The id of the parent receiving the additional agreement"
            data_tests:
              - not_null
              - relationships:
                  arguments:
                    to: source('public', 'parents')
                    field: id
              - dbt_utils.expression_is_true:
                  arguments:
                    expression: "<> to_parent_id"
                    column_name: from_parent_id
          - name: during
            description: "The start and end time of the additional agreement"
            data_tests:
              - not_null
          - name: created_at
            description: "The date and time the additional agreement was created"
            data_tests:
              - not_null
          - name: updated_at
            description: "The date and time the additional agreement was updated"
            data_tests:
              - not_null

      - name: additional_agreements_details
        description: "The additional agreements details table"
        columns:
          - name: additional_agreements_id
            description: "The id of the additional agreement the detail belongs to"
            data_tests:
              - not_null
              - relationships:
                  arguments:
                    to: source('public', 'additional_agreements')
                    field: id
          - name: reason
            description: "The reason for the additional agreement"
            data_tests:
              - not_null
          - name: created_at
            description: "The date and time the additional agreement detail was created"
          - name: updated_at
            description: "The date and time the additional agreement detail was updated"
